import pandas as pd import requests import time POLYGON_API_KEY = "" pg_tickers = ["C:EURUSD", "X:BTCUSD"] def main(): fx_data = get_fx_pairs_data(pg_tickers) fx_data = format_fx_pairs(fx_data) print(fx_data["C:EURUSD"].head()) def get_fx_pairs_data(pg_tickers): start = "2025-01-01" end = "2025-01-03" multiplier = 1 timespan = "minute" fx_pairs_dict = {} for pair in pg_tickers: url = ( f"https://api.polygon.io/v2/aggs/ticker/{pair}/range/" f"{multiplier}/{timespan}/{start}/{end}" f"?adjusted=true&sort=asc&limit=50000&apiKey={POLYGON_API_KEY}" ) response = requests.get(url) print(pair, response.status_code) if response.status_code != 200: print(response.text) continue if not response.headers.get("Content-Type", "").startswith("application/json"): print("NON-JSON:", response.text[:100]) continue data = response.json() # VWAP = Σ(Price × Volumina) / Σ(Volumina) # Close > VWAP = Buy dominance # Close < VWAP = Sell dominance print(pair, "resultsCount:", data.get("resultsCount")) fx_pairs_dict[pair] = pd.DataFrame(data.get("results", [])) time.sleep(12) #Rate-Limit return fx_pairs_dict def format_fx_pairs(fx_pairs_dict): for pair, df in fx_pairs_dict.items(): if df.empty: continue df["t"] = pd.to_datetime(df["t"], unit="ms") fx_pairs_dict[pair] = df.set_index("t") return fx_pairs_dict if __name__ == "__main__": main()